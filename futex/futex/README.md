4.1

a) futex для volatile переменных(futex_with_memory_barriers_weak):

Так как компилятору и процессору запрещено проводить любые оптимизации связанные с volatile-данными, 
то для корректной работы можно установить минимально возможный барьер: std::memory_order_relaxed.

б) futex для обычных переменных(futex_with_memory_barriers_strong):

Поскольку необходимо ограничить код внутри критической секции от его возможных переносов за пределы секции, 
то минимальным барьером в начале секции(при вызове lock()) 
будет барьер для ограничения на перенос кода выше барьера(std::memory_order_acquire), 
  и аналогичный ему - std::memory_order_release для запрета переноса строк ниже чем конец секции(при вызове unlock()).
