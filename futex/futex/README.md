4.1

Хотим модифицировать futex (используя минимально возможные барьеры памяти), чтобы компилятор и процессор не могли переставлять строки кода изнутри критической секции наружу:

a) futex для volatile переменных(futex_with_memory_barriers_weak):

Так как компилятору и процессору запрещено проводить любые оптимизации связанные с volatile-данными, 
то для корректной работы можно установить минимально возможный барьер: std::memory_order_relaxed.

б) futex для обычных переменных(futex_with_memory_barriers_strong):

Очевидно, что нужно использовать хотя бы 2 барьера памяти для ограничения критической секции(в начале и в конце), 
значит минимальным барьером в начале секции(при вызове lock()) 
будет барьер для ограничения на перенос кода вверх(std::memory_order_acquire), 
  и аналогичный ему std::memory_order_release в конце секции для запрета переноса строк вниз(при вызове unlock()).
